# Blink example : Timer Based Blinking

Another way to get a more precise blink rate on your LED is to use one of
the timers in the chip.

In this example we use timer 6, one of the "basic" timers (very few features)
to allow us to briefly delay before toggling the LED.

The timer clocks are generated by the peripheral bus they are attached
to by default. If the prescaler is set to anything other than 1 (in the
clock code I set them to 4 for `APB1`, and 2 for `APB1`), the timer clock
is 2x the `APB` clock. Timer 6 is attached to `APB1` so its clocked
internally at 2 x 42 MHz or 84 MHz. Note you can connect them directly
to `PCLK` (the system clock) using the `RCC_DCLKCFGR` register `TMPRE` bit.

The timer clock goes into a prescaler (`TIM6_PSC`) which is a 'divide
by n' where n is (`PSC` value + 1) (so if the `PSC` has 0 in it, which
is the default, it divides by (0 + 1) or 1. Using the prescaler,
we can set the interval between counts. The `PSC` is a 16 bit unsigned
value so the maximum prescale value is 65,536 (65,535 + 1).

For example, setting `PSC` to `83` is actually a division by 84. The
timer will divide the 84 MHz clock down to a 1 MHz clock. Thus each count
in the timer represents 1 uS in time. Alternatively, setting it to 8399
means the clock is 10 kHz so each count represents 100 uS in time.

Timer 6's count is loaded into the `ARR` register (`TIM6_ARR`). Timer 6 is
so basic it only counts up (other counters have more flexible counting
schemes).

It is important to note that the `UIF` flag, which we use to note that the
timer is done counting, is set on *overflow*. What that means for this example
is that the counter goes up to the count loaded into `ARR`, and then _ONE MORE
COUNT_ before it overflows. One way to think of that behavior is that the ARR
register represents one less than the actual number of counts in the delay. 

Timer 6's prescaler and count are both 16 bit values, the timer counts
up, so setting the count (`ARR`) to 0xffff means it will count all the
way to 65,535 and then one more count to overflow. Thus the maximum
delay you could create in this situation with both `PSC` and `ARR` set to
0xffff, is 65536 / 1281.7383 or 51.1 seconds.

Some chips have Timer 5 and Timer 2 which are 32 bit counters and
can give you much longer delays.

In this code we set the pre-scaler to 8399 which gives us 100 uS per count,
and we set the count register to 499 which yeilds a delay of 50 mS per loop.
The LED alternates its state every loop, so we perceive it as blinking at
10 Hz. (50 mS on, 50 mS off)
